accounts:
  - name: czi-id
    id: 416703108729
    role: czi-admin
    owner: shared-infra@chanzuckerberg.com
  - name: czi-corp
    id: 252147947505
    role: czi-admin
    owner: alin@chanzuckerberg.com
  - name: czi-si
    id: 626314663667
    role: czi-admin
    owner: shared-infra@chanzuckerberg.com
  - name: czi-logs
    id: 724328632434
    role: czi-admin
    owner: shared-infra@chanzuckerberg.com
  - name: meta-2
    id: 607813682535
    role: czi-admin
    owner: meta-infra@chanzuckerberg.com
  - name: edinnovationlabs
    id: 805813389673
    role: czi-admin
    owner: shared-infra@chanzuckerberg.com
  - name: czi-sec
    id: 871040364337
    role: czi-admin
    owner: shared-infra@chanzuckerberg.com
  - name: czi-domains
    id: 382303590750
    role: czi-admin
    owner: shared-infra@chanzuckerberg.com
  # - name: czi-physec
  #   id: 728896018347
  #   role: czi-admin
  #   owner: alin@chanzuckerberg.com

identity_map:
  - email: shared-infra@chanzuckerberg.com
    slack: org-shared-infra
  - email: meta-infra@chanzuckerberg.com
    slack: meta-infra

policies:
  - name: owner-ec2
    resource_selector: "name in (ec2_instance)"
    tag_selector: "!owner"
    label_selector: ""
    max_age: 20000h

    notifications:
      - recipient: $owner
        message_template: >
          *WARNING*– EC2 Instance <{{.Resource.GetConsoleURL}}|{{.ResourceID}}> in account
          `{{.AccountName}}` does not have an owner tag. See our <https://wiki.czi.team/display/SI/AWS+Usage+Policy|Usage Policy> for more information.

          Note– you need to auth to the account before you click the link.

  - name: owner-s3
    resource_selector: "name in (s3)"
    tag_selector: "!owner"
    label_selector: ""
    max_age: 20000h

    notifications:
      - recipient: rking@chanzuckerberg.com
        message_template: >
          S3 Bucket <{{.Resource.GetConsoleURL}}|{{.ResourceID}}> in account `{{.AccountName}}`
          does not have an owner tag. See our <https://wiki.czi.team/display/SI/AWS+Usage+Policy|Usage Policy>
          for more information.

          Note– you need to auth to the account before you click the link.


  # - name: owner-ebs
  #   resource_selector: "name in (ebs_volume)"
  #   tag_selector: "!owner"
  #   label_selector: ""
  #   max_age: 20000h

  #   notifications:
  #     - recipient: rking@chanzuckerberg.com
  #       message_template: >
  #         EBS Volume <{{.Resource.GetConsoleURL}}|{{.ResourceID}}> in account `{{.AccountName}}` does not have an owner tag.

  - name: unattached-ebs
    resource_selector: "name in (ebs_volume)"
    tag_selector: ""
    label_selector: "state=available"
    max_age: 20000h

    notifications:
      - recipient: rking@chanzuckerberg.com
        message_template: >
          *WARNING* – EBS Volume <{{.Resource.GetConsoleURL}}|{{.ResourceID}}> in account `{{.AccountName}}` and region {{.Resource.Region}} is unused.

          It was created approximately {{.Age}} ago and it will be automatically deleted in {{.TTL}} if still unattached.

          See our <https://wiki.czi.team/display/SI/AWS+Usage+Policy|Usage Policy> for more information.

          Note– you need to auth to the account before you click the link.


  - name: owner-vpc
    resource_selector: "name in (vpc)"
    tag_selector: "!owner"
    label_selector: ""
    max_age: 20000h

    notifications:
      - recipient: rking@chanzuckerberg.com
        message_template: >
          *WARNING*– VPC <{{.Resource.GetConsoleURL}}|{{.ResourceID}}> in account `{{.AccountName}}` does not have an owner tag.
          See our <https://wiki.czi.team/display/SI/AWS+Usage+Policy|Usage Policy> for more information.

          Note– you need to auth to the account before you click the link.

  - name: iam-user-mfa
    resource_selector: "name=iam_user"
    tag_selector: ""
    label_selector: "has_password,!has_mfa"
    max_age: 20000h
    notifications:
      - recipient: rking@chanzuckerberg.com
        message_template: >
          IAM User <{{.Resource.GetConsoleURL}}|{{.ResourceID}}> in account `{{.AccountName}}` has a password and no MFA device. <https://www.google.com/|google>
      - recipient: $owner
        message_template: >
          Your IAM user in account `{{.AccountName}}` has a password but no MFA device. Please add an MFA device ASAP.
          See AWS docs for this <https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_enable_virtual.html|here>
          And ask in <#help-infra> if you need assistance.

aws_regions:
  - us-east-1
  - us-west-1
  - us-west-2
